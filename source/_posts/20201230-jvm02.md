---
title: 垃圾回收随笔
date: 2020-12-30 16:12:09
tags:
    - java
    - jvm
categories:
    - jvm
top_img:
cover: https://cdn.jsdelivr.net/gh/dogYin/imgOSS/img/java.jpg
---
　　在[jvm内存空间](https://dogyin.wang/2020/09/17/20200917-jvm01/)这篇文章有详细的介绍有关java中内存的那些事，我们知道每一个被声明的变量以及创建出来的对象都需要一个容器承载，这个容器便是之前介绍的内存空间，既然每个微小的变量都需要地方存储，并且程序是运行在服务器上的，那么这个容器势必是有大小，既然有了边界限制那么就不可能无限制的往容器里装东西，为了我们能不断的往里面装新的东西，那么必须有应对措施，而我们能想到了通常有两种：1.增加容器的容量。2.清理无用垃圾。我们所说的垃圾回收机制可以从这两点触发至发散。

# 增加容器容量

　　怎么理解增加容器容量呢？如果单纯说增加容器容量其实是比较不严谨的说法，目前的各种业务场景都是基于微服务的，就是将服务按模块或者业务拆分为单独的块部署在各种小型机提供服务，如果一味的增加容量，小心机就会变成一个很累赘的大胖子，显然是不符合场景的，无论是当下还是以前这种情况都是不允许出现的。
　　但是，合理的调配堆大小也是不可忽略的；有种现象就是当我们服务刚刚启动是会发生频繁的GC，这是为什么呢？通过GC监控工具发现这种情况通常是由于Allocation Failure，这是由于 -Xmx -Xms两个参数设置大小不一，在初始阶段只申请大小为-Xms，当需要扩容时会触发垃圾收集，所以当发生不断扩容时就会有伴随着频繁的垃圾收集，那么为了避免频繁的垃圾收集是不是应该将两个参数都设置到一致；其实也分场景，如果是面向C端的服务，需要跟用户频繁的交互，无法忍受高频的停顿，但与之相反，对于一些富客户端应用两个参数的梯次配置倒是能节省一些空间。

# 清理无用垃圾

　　上面分析了增加容量的场景，但是增加容量显得比较有局限性；大头的动作应该放在垃圾清理这边。我们很了解生活场景中出现的垃圾，并会将其带离日常生活区域，同理要想知道怎么清理垃圾，要从以下个方面入手
1. 垃圾在哪里
2. 垃圾是什么
3. 怎么清理

## 1.垃圾在哪里

　　在分析垃圾在哪里之前，首先应该知道[jvm内存空间](https://dogyin.wang/2020/09/17/20200917-jvm01/)是如何布局的，这里假设了解了内存布局是什么样的，那么我们现在找找垃圾在哪里为了便于分析我们先放张图
![](https://cdn.jsdelivr.net/gh/dogYin/imgOSS/img/jvm_grabe.PNG)
如上图所示，虚拟机栈和本地方法栈里面存储基本就是各种局部变量、动态链接和方法返回值等，而我们知道上述这些描述都是实例对象的引用指针，随着线程状态决定其生死所以垃圾回收我们不考虑这两块空间，其次就是程序计数器这块空间就是指向程序执行到哪里，也算是随着线程生死。
　　接下来就是元空间和堆空间，我们知道元空间存储的是


## 2.垃圾是什么

## 3.怎么清理